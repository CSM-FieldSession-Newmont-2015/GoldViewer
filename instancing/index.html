<html>
	<head>
		<title>Instancing Test</title>
		<script type="text/javascript" src="three.js"></script>
		<script type="text/javascript" src="OrbitControls.js"></script>
		<script type="text/javascript" src="stats.min.js"></script>
		<script type="text/javascript" src="main.js"></script>

		<script id="renderVertexShader" type="x-shader/x-vertex">
			precision highp float;

			uniform mat4 modelViewMatrix;
			uniform mat4 projectionMatrix;
			uniform vec4 color;

			attribute vec3 position;
			attribute vec3 offset;
			attribute vec3 scale;

			varying vec4 vColor;
			varying vec3 vPosition;

			// Shader for @@name@@.
			void main() {
				vColor = color;
				vPosition = offset;
				vec3 newPosition =  scale * position;
				gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0);
			}
		</script>

		<script id="renderFragmentShader" type="x-shader/x-fragment">
			precision mediump float;

			varying vec4 vColor;
			varying vec3 vPosition;
			uniform float time;

			// Shader for @@name@@.
			void main() {
				gl_FragColor = vColor;
				if (vPosition.z < 100.0 * sin(time) + 100.0) {
					//gl_FragColor.a -= 0.5;
				}
			}
		</script>

		<script id="hoverVertexShader" type="x-shader/x-vertex">
			precision highp float;

			uniform float time;

			attribute vec3 color;
			attribute vec3 offset;
			attribute vec3 scale;
			attribute vec4 quaternion;

			varying vec4 vColor;

			vec3 rotate_vector( vec4 quat, vec3 vec ) {
				return vec + 2.0 * cross( cross( vec, quat.xyz ) + quat.w * vec, quat.xyz );
			}

			// Shader for @@name@@.
			void main() {
				vColor = vec4(color, 1.0);

				vec3 newPosition = scale * position;
				newPosition = rotate_vector( quaternion, newPosition);
				newPosition = newPosition + offset;
				gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0);
			}
		</script>

		<script id="hoverFragmentShader" type="x-shader/x-fragment">
			precision mediump float;

			varying vec4 vColor;

			// Shader for @@name@@.
			void main() {
				gl_FragColor = vColor;
			}
		</script>

		<style>
			* {
				margin: 0;
				padding: 0;
			}
			html, body {
				width: 100%;
				height:100%;
			}
			canvas {
				display:block;
				height: 100vh;
				width: 100vw;
			}
		</style>
	</head>


	<body onload="start()">
		<canvas id="canvas">
			Oops.
		</canvas>
	</body>
</html
